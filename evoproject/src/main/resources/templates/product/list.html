<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Product List</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" />
  <link rel="stylesheet" th:href="@{/css/styles.css}">
  <script src="script.js"></script>
  <style>
    .product {
      position: relative;
      width: 200px;
      height: 300px;
      margin: 10px;
      float: left;
      border: 1px solid #ccc;
      padding: 10px;
      cursor: pointer;
    }
    .product img {
      width: 100%;
      height: 200px;
    }
    .add-to-cart {
      display: none;
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #000;
      color: #fff;
      padding: 5px 10px;
      cursor: pointer;
    }
    .product:hover .add-to-cart {
      display: block;
    }
    .pagination {
      width: 100%;
      position: absolute;
      bottom: 10px;
      display: flex;
      justify-content: center;
    }
    .pagination ul {
      padding: 0;
      list-style: none;
      text-align: center;
    }
    .pagination li {
      display: inline;
      margin: 0 5px;
    }
    .pagination li a {
      text-decoration: none;
    }
    .pagination li.active a {
      font-weight: bold;
    }
  </style>
  <script>
    // 정렬 기준 변경 함수
    function onSortChange() {
      var sort = document.getElementById("sortSelect").value;
      var currentPage = document.getElementById("currentPage").value;
      var categoryId = document.getElementById("categoryId").value;

      var url;
      if (categoryId) {
        // 카테고리별 조회
        url = "/product/category/" + categoryId + "?sort=" + sort + "&page=" + currentPage + "&size=16";
      } else {
        // 전체 상품 조회
        url = "/product?sort=" + sort + "&page=" + currentPage + "&size=16";
      }

      window.location.href = url;
    }

    // 각 상품에 클릭 리스너 추가
    document.addEventListener('DOMContentLoaded', function () {
      var products = document.querySelectorAll('.product');
      products.forEach(function (product) {
        var addToCartButton = product.querySelector('.add-to-cart');
        product.addEventListener('click', function (event) {
          if (event.target !== addToCartButton) {
            var productNo = product.getAttribute('data-product-no');
            console.log('Redirecting to product number:', productNo);
            redirectToDetailPage(productNo);
          }
        });
      });
    });

    // 상세 페이지로 리다이렉트하는 함수
    function redirectToDetailPage(productNo) {
      window.location.href = '/product/detail/' + productNo;
    }
  </script>
</head>
<header th:replace="header :: header"></header>
<body>



<h1>Product List</h1>

<!-- 정렬 드롭다운 -->
<div>
  <select id="sortSelect" onchange="onSortChange()">
    <option value="pro_date_desc" th:selected="${productsResponse.sort == 'pro_date_desc'}">최근 등록순</option>
    <option value="price_asc" th:selected="${productsResponse.sort == 'price_asc'}">가격 오름차순</option>
    <option value="price_desc" th:selected="${productsResponse.sort == 'price_desc'}">가격 내림차순</option>
    <option value="viewCount_desc" th:selected="${productsResponse.sort == 'viewCount_desc'}">조회수순</option>
  </select>
  <input type="hidden" id="categoryId" th:value="${categoryId}">
</div>

<!-- 현재 페이지를 숨김 필드로 추가 -->
<input type="hidden" id="currentPage" th:value="${productsResponse.currentPage}" />


<!-- 상품 목록 -->
<div id="product-container">
  <div th:each="product : ${products}" class="product" th:data-product-no="${product.productNo}">
    <img th:if="${product.mainImage != null}" th:src="@{${product.mainImage.imageName}}" alt="Product Image">
    <h2 th:text="${product.productName}">Product Name</h2>
    <p th:text="${product.soldout ? 'Sold Out' : product.price + ' 원'}"></p>
    <div class="add-to-cart" th:if="${!product.soldout}">Add to cart</div>
  </div>
</div>

<!-- 페이지네이션 -->
<div class="pagination">
  <ul>
    <!-- 이전 페이지 버튼 -->
    <li th:if="${productsResponse.currentPage > 1}">
      <a th:href="@{${categoryId != null ? '/product/category/' + categoryId : '/product'}(page=${productsResponse.currentPage - 1}, size=16, sort=${productsResponse.sort})}">Prev</a>
    </li>

    <!-- 페이지 번호 반복 -->
    <li th:each="pageNum : ${#numbers.sequence(1, productsResponse.totalPages)}" th:classappend="${pageNum == productsResponse.currentPage} ? 'active'">
      <a th:href="@{${categoryId != null ? '/product/category/' + categoryId : '/product'}(page=${pageNum}, size=16, sort=${productsResponse.sort})}" th:text="${pageNum}">1</a>
    </li>

    <!-- 다음 페이지 버튼 -->
    <li th:if="${productsResponse.currentPage < productsResponse.totalPages}">
      <a th:href="@{${categoryId != null ? '/product/category/' + categoryId : '/product'}(page=${productsResponse.currentPage + 1}, size=16, sort=${productsResponse.sort})}">Next</a>
    </li>
  </ul>
</div>

<!-- 푸터 추가 -->

</body>

</html>
<footer th:replace="footer :: footer"></footer>