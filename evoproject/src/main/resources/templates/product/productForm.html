<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${isEdit} ? '상품 수정' : '새 상품 추가'">새 상품 추가</title>
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        .preview-img {
            width: 100px;
            height: 100px;
            margin: 10px;
        }
    </style>
</head>
<body>
<h1 th:text="${isEdit} ? '상품 수정' : '새 상품 추가'">새 상품 추가</h1>
<form id="productForm" th:action="@{${isEdit} ? '/admin/product/update' : '/admin/product/save'}" method="post" enctype="multipart/form-data">
    <input type="hidden" th:if="${isEdit}" name="productNo" th:value="${product.productNo}"/>
    <input type="hidden" name="isEdit" th:value="${isEdit}"/>

    <label for="productName">상품 이름:</label>
    <input type="text" id="productName" name="productName" th:value="${product.productName}" required/>

    <label for="productDes">상품 설명:</label>
    <textarea id="productDes" name="productDes" required th:text="${product.productDes}"></textarea>

    <label for="categoryId">카테고리:</label>
    <select id="categoryId" name="categoryId" required>
        <option value="1" th:selected="${product.categoryId == 1}">Chair</option>
        <option value="2" th:selected="${product.categoryId == 2}">Lamp</option>
        <option value="3" th:selected="${product.categoryId == 3}">Table</option>
        <option value="4" th:selected="${product.categoryId == 4}">Cabinet</option>
        <option value="5" th:selected="${product.categoryId == 5}">Decorative</option>
        <option value="6" th:selected="${product.categoryId == 6}">Tableware</option>
    </select>

    <label for="price">가격:</label>
    <input type="number" id="price" name="price" th:value="${product.price}" required/>

    <label for="shipping">배송:</label>
    <input type="number" id="shipping" name="shipping" th:value="${product.shipping}" required/>

    <label for="stock">재고:</label>
    <input type="number" id="stock" name="stock" th:value="${product.stock}" required/>

    <label for="images">이미지:</label>
    <input type="file" id="images" name="images" multiple accept="image/*" onchange="previewImages()"/>
    <div id="preview"></div>

    <div th:if="${isEdit}">
        <h3>기존 이미지</h3>
        <div th:each="imageUrl : ${imageUrls}">
            <img th:src="${imageUrl}" alt="상품 이미지" class="preview-img"/>
        </div>
    </div>

    <button type="submit" th:text="${isEdit} ? '상품 수정' : '상품 추가'">상품 추가</button>
</form>

<a th:href="@{/admin/product}">목록으로 돌아가기</a>

<script>
    let selectedFiles = [];

    function previewImages() {
        const files = document.getElementById('images').files;
        selectedFiles = selectedFiles.concat(Array.from(files));
        updatePreview();
    }

    function updatePreview() {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';

        selectedFiles.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.classList.add('preview-img');
                preview.appendChild(img);

                // Add remove button
                const removeButton = document.createElement('button');
                removeButton.textContent = '이미지 삭제';
                removeButton.type = 'button';
                removeButton.onclick = () => removeImage(index);
                preview.appendChild(removeButton);
            };
            reader.readAsDataURL(file);
        });
    }

    function removeImage(index) {
        selectedFiles.splice(index, 1);
        updatePreview();
    }

    document.getElementById('productForm').onsubmit = function(e) {
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => dataTransfer.items.add(file));
        document.getElementById('images').files = dataTransfer.files;
    }
</script>

</body>
</html>
