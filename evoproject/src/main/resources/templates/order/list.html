<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주문 목록</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
  <h1>주문 목록</h1>
  <table class="table">
    <thead>
    <tr>
      <th>주문번호</th>
      <th>주문일</th>
      <th>주문 상태</th>
      <th>총 금액</th>
      <th>상세 보기</th>
      <th>취소</th>
      <th>반품</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="order : ${orders}">
      <td th:text="${order.orderNo}"></td>
      <td th:text="${#dates.format(order.orderTimestamp, 'yyyy-MM-dd HH:mm')}"></td>
      <td th:text="${order.orderStatus}"></td>
      <td th:text="${order.orderPayment}"></td>
      <td><a th:href="@{/order/detail/{orderNo}(orderNo=${order.orderNo})}" class="btn btn-info">상세 보기</a></td>
      <td>
        <button th:if="${order.orderStatus == '결제 대기' or order.orderStatus == '배송 준비중'}"
                th:onclick="'showCancelPopup(' + ${order.orderNo} + ');'" class="btn btn-danger">취소</button>
      </td>
      <td>
        <button th:if="${order.orderStatus == '배송 완료'}"
                th:onclick="'showReturnPopup(' + ${order.orderNo} + ');'" class="btn btn-warning">반품</button>
      </td>
    </tr>
    </tbody>
  </table>

  <!-- 취소 확인 팝업 -->
  <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelOrderModalLabel">주문 취소 확인</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          주문을 취소하시겠습니까?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="button" class="btn btn-danger" id="confirmCancelButton">취소</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 반품 요청 팝업 -->
  <div class="modal fade" id="returnOrderModal" tabindex="-1" aria-labelledby="returnOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="returnOrderModalLabel">반품 요청 확인</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          반품 요청을 하시겠습니까?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
          <button type="button" class="btn btn-warning" id="confirmReturnButton">반품 요청</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
<script>
  function showCancelPopup(orderNo) {
    const cancelButton = document.getElementById('confirmCancelButton');
    cancelButton.onclick = function () {
      // 여기에 주문 취소 요청을 서버로 전송하는 코드를 추가하세요.
      console.log('주문 번호', orderNo, '취소 요청 전송');
      // 서버로 요청을 보낸 후, 성공적으로 처리되면 페이지를 새로고침합니다.
      location.reload();
    };
    new bootstrap.Modal(document.getElementById('cancelOrderModal')).show();
  }

  function showReturnPopup(orderNo) {
    const returnButton = document.getElementById('confirmReturnButton');
    returnButton.onclick = function () {
      // 여기에 반품 요청을 서버로 전송하는 코드를 추가하세요.
      console.log('주문 번호', orderNo, '반품 요청 전송');
      // 서버로 요청을 보낸 후, 성공적으로 처리되면 페이지를 새로고침합니다.
      location.reload();
    };
    new bootstrap.Modal(document.getElementById('returnOrderModal')).show();
  }
</script>
</body>
</html>
